# Google Veo 3 è§†é¢‘ç”Ÿæˆæç¤ºè¯æ”¹è¿›æ–¹æ¡ˆ

## ğŸ“… æ–‡æ¡£ä¿¡æ¯
- **åˆ›å»ºæ—¶é—´**: 2025-09-05
- **ç‰ˆæœ¬**: v1.0
- **é¡¹ç›®**: OrientDirector - Doroåˆå½±è§†é¢‘ç”Ÿæˆæç¤ºè¯ä¼˜åŒ–

## ğŸ¯ é—®é¢˜åˆ†æ

### 1. ç‰ˆæœ¬å¯¹æ¯”åˆ†æ

#### ğŸ“Š Commit 533ad5e ç‰ˆæœ¬ç‰¹ç‚¹
**ä¼˜ç‚¹**:
- âœ… ç”Ÿæˆçš„å›¾ç‰‡ç¬¦åˆç›®æ ‡æç¤ºè¯å’Œå›¾åƒç»„åˆéœ€æ±‚
- âœ… å›¾ç‰‡è´¨é‡é«˜ï¼Œäººç‰©å’ŒDoroå½¢è±¡æ¸…æ™°
- âœ… æ™¯ç‚¹èƒŒæ™¯å‡†ç¡®ï¼Œæ„å›¾åˆç†

**ç¼ºç‚¹**:
- âŒ è§†é¢‘ç”ŸæˆAPIè°ƒç”¨å¤±è´¥ï¼ˆå‚æ•°æ ¼å¼é—®é¢˜ï¼‰
- âŒ æç¤ºè¯ç›¸å¯¹ç®€å•ï¼Œç¼ºä¹ä¸°å¯Œçš„ç»†èŠ‚

#### ğŸ“Š å½“å‰ç‰ˆæœ¬ï¼ˆ1c29432ï¼‰ç‰¹ç‚¹
**ä¼˜ç‚¹**:
- âœ… è§†é¢‘ç”ŸæˆæŠ€æœ¯ç¨³å®šï¼ŒAPIè°ƒç”¨æˆåŠŸ
- âœ… å®Œæ•´çš„å¼‚æ­¥æ“ä½œå¤„ç†
- âœ… åŒé‡å›¾ç‰‡ç”Ÿæˆç­–ç•¥ï¼ˆImagen 3 + åå¤‡ï¼‰

**ç¼ºç‚¹**:
- âŒ å›¾ç‰‡æç¤ºè¯è¿‡äºç®€åŒ–
- âŒ ç¼ºä¹ç°æœ‰Doroåˆå½±åŠŸèƒ½çš„ä¸°å¯Œæç¤ºè¯é€»è¾‘
- âŒ æ²¡æœ‰åˆ©ç”¨ç”¨æˆ·ç…§ç‰‡å’ŒDoroç…§ç‰‡çš„ç‰¹å¾æå–

### 2. æ ¸å¿ƒå·®å¼‚åˆ†æ

#### ğŸ” 533ad5eç‰ˆæœ¬çš„å›¾ç‰‡æç¤ºè¯é€»è¾‘ï¼š
```python
# ç®€å•çš„æç¤ºè¯æ„å»º
prompt = f"Create a high-quality travel photo showing a real person and their charming animated character companion Doro at the famous {attraction_name} in {location}"

# åŸºç¡€å§¿åŠ¿é€‰æ‹©
poses = ["taking a selfie together", "posing happily", "giving thumbs up", "making peace signs", "smiling at the camera"]
pose = random.choice(poses)
prompt += f". They are {pose}"

# ç®€å•çš„æœè£…å’Œå…‰çº¿æè¿°
prompt += ", wearing casual travel attire"
prompt += f", {time_descriptions.get(time_of_day, 'with natural lighting')}"
prompt += ". Professional photography, high resolution, vibrant colors, perfect composition, travel photography style"
```

#### ğŸ” å½“å‰ç‰ˆæœ¬çš„Doroåˆå½±æç¤ºè¯é€»è¾‘ï¼ˆæ›´ä¸°å¯Œï¼‰ï¼š
```python
# ä½¿ç”¨ä¸“ä¸šçš„æç¤ºè¯ç”Ÿæˆå™¨
main_prompt = doro_prompt_generator.generate_attraction_doro_prompt(
    attraction_name=attraction_info.get("name"),
    attraction_type=attraction_info.get("category"),
    location=attraction_info.get("location"),
    with_style=style_photo is not None,
    doro_style=attraction_info.get("doro_style", "default"),
    user_description=attraction_info.get("user_description")
)

# é£æ ¼è¿ç§»æç¤º
if style_photo:
    style_prompt = doro_prompt_generator.generate_style_transfer_prompt()
    main_prompt = f"{main_prompt}. {style_prompt}"

# è¯¦ç»†çš„å¢å¼ºæç¤ºè¯
main_prompt = doro_prompt_generator.enhance_prompt_with_details(
    main_prompt,
    time_of_day=attraction_info.get("time_of_day"),
    weather=attraction_info.get("weather"),
    season=attraction_info.get("season"),
    mood=attraction_info.get("mood")
)

# åŒ…å«ç”¨æˆ·ç…§ç‰‡ã€Doroç…§ç‰‡å’Œé£æ ¼ç…§ç‰‡
contents = [main_prompt, user_image, doro_image]
if style_image:
    contents.append(style_image)

# è´Ÿé¢æç¤ºè¯
negative_prompt = doro_prompt_generator.get_negative_prompt()
contents.append(f"Avoid: {negative_prompt}")
```

## ğŸš€ æ”¹è¿›æ–¹æ¡ˆ

### 1. æ ¸å¿ƒæ”¹è¿›ç­–ç•¥

#### ğŸ¯ ç›®æ ‡ï¼š
- ä¿æŒå½“å‰ç‰ˆæœ¬çš„ç¨³å®šè§†é¢‘ç”ŸæˆæŠ€æœ¯
- å°†ç°æœ‰Doroåˆå½±çš„ä¸°å¯Œæç¤ºè¯é€»è¾‘åº”ç”¨åˆ°è§†é¢‘ç”Ÿæˆçš„å›¾ç‰‡é˜¶æ®µ
- ç¡®ä¿ç”Ÿæˆçš„å›¾ç‰‡è´¨é‡è¾¾åˆ°533ad5eç‰ˆæœ¬çš„æ°´å¹³

#### ğŸ”§ æŠ€æœ¯æ–¹æ¡ˆï¼š
1. **é‡æ„`_generate_image_prompt_for_video`å‡½æ•°**
2. **é›†æˆ`DoroPromptGenerator`çš„å®Œæ•´é€»è¾‘**
3. **æ·»åŠ ç”¨æˆ·ç…§ç‰‡å’ŒDoroç…§ç‰‡çš„ç‰¹å¾æå–**
4. **ä¿æŒè§†é¢‘ç”Ÿæˆçš„æˆåŠŸæŠ€æœ¯ä¸å˜**

### 2. å…·ä½“æ”¹è¿›ä»£ç 

#### ğŸ“ æ–°çš„å›¾ç‰‡æç¤ºè¯ç”Ÿæˆå‡½æ•°ï¼š

```python
async def _generate_image_prompt_for_video(
    self, 
    user_photo: UploadFile,
    doro_photo: UploadFile,
    attraction_info: Dict,
    style_photo: Optional[UploadFile] = None
) -> str:
    """
    ä¸ºè§†é¢‘ç”Ÿæˆåˆ›å»ºå›¾ç‰‡æç¤ºè¯ï¼ˆä½¿ç”¨å®Œæ•´çš„Doroåˆå½±é€»è¾‘ï¼‰
    
    Args:
        user_photo: ç”¨æˆ·ç…§ç‰‡
        doro_photo: Doroå½¢è±¡
        attraction_info: æ™¯ç‚¹ä¿¡æ¯
        style_photo: é£æ ¼å‚è€ƒï¼ˆå¯é€‰ï¼‰
        
    Returns:
        å›¾ç‰‡ç”Ÿæˆæç¤ºè¯
    """
    # å¯¼å…¥æç¤ºè¯ç”Ÿæˆå™¨
    from .prompt_generator import doro_prompt_generator
    
    # ä½¿ç”¨ä¸Doroåˆå½±ç›¸åŒçš„æç¤ºè¯ç”Ÿæˆé€»è¾‘
    main_prompt = doro_prompt_generator.generate_attraction_doro_prompt(
        attraction_name=attraction_info.get("name"),
        attraction_type=attraction_info.get("category", "åŸå¸‚åœ°æ ‡"),  # é»˜è®¤ç±»å‹
        location=attraction_info.get("address", attraction_info.get("location")),
        with_style=style_photo is not None,
        doro_style=attraction_info.get("doro_style", "default"),
        user_description=attraction_info.get("user_description")
    )
    
    # å¦‚æœæœ‰æœè£…é£æ ¼ï¼Œæ·»åŠ é£æ ¼è¿ç§»æç¤º
    if style_photo:
        style_prompt = doro_prompt_generator.generate_style_transfer_prompt()
        main_prompt = f"{main_prompt}. {style_prompt}"
    
    # å¢å¼ºæç¤ºè¯ï¼ˆæ ¹æ®é¢å¤–å‚æ•°ï¼‰
    main_prompt = doro_prompt_generator.enhance_prompt_with_details(
        main_prompt,
        time_of_day=attraction_info.get("time_of_day"),
        weather=attraction_info.get("weather"),
        season=attraction_info.get("season"),
        mood=attraction_info.get("mood")
    )
    
    # æ·»åŠ è§†é¢‘ç”Ÿæˆç‰¹å®šçš„è¦æ±‚
    video_specific_prompt = (
        ". This image will be used as the base for video generation, "
        "so ensure clear, stable composition with both subjects clearly visible. "
        "Avoid complex backgrounds that might interfere with video motion. "
        "Focus on natural, authentic expressions and poses suitable for animation"
    )
    
    main_prompt += video_specific_prompt
    
    logger.info(f"è§†é¢‘å›¾ç‰‡æç¤ºè¯: {main_prompt[:200]}...")
    return main_prompt
```

#### ğŸ“ æ”¹è¿›çš„è§†é¢‘ç”Ÿæˆå‡½æ•°ï¼ˆç¬¬ä¸€æ­¥ï¼‰ï¼š

```python
# åœ¨generate_doro_video_with_attractionå‡½æ•°ä¸­çš„ç¬¬ä¸€æ­¥æ”¹è¿›
try:
    # ä½¿ç”¨æ”¹è¿›çš„å›¾ç‰‡æç¤ºè¯ç”Ÿæˆ
    image_prompt = await self._generate_image_prompt_for_video(
        user_photo=user_photo,
        doro_photo=doro_photo,
        attraction_info=attraction_info,
        style_photo=style_photo
    )
    logger.info(f"ğŸ“ å›¾ç‰‡æç¤ºè¯: {image_prompt[:200]}...")
    
    # å‡†å¤‡å›¾ç‰‡å†…å®¹ï¼ˆä¸Doroåˆå½±ç›¸åŒçš„é€»è¾‘ï¼‰
    # è¯»å–å¹¶å¤„ç†ç”¨æˆ·ç…§ç‰‡
    user_photo.file.seek(0)
    user_image = Image.open(user_photo.file)
    if user_image.mode != 'RGB':
        user_image = user_image.convert('RGB')
    
    # è¯»å–å¹¶å¤„ç†Doroç…§ç‰‡
    doro_photo.file.seek(0)
    doro_image = Image.open(doro_photo.file)
    if doro_image.mode != 'RGB':
        doro_image = doro_image.convert('RGB')
    
    # è¯»å–é£æ ¼ç…§ç‰‡ï¼ˆå¦‚æœæœ‰ï¼‰
    style_image = None
    if style_photo:
        try:
            style_photo.file.seek(0)
            style_image = Image.open(style_photo.file)
            if style_image.mode != 'RGB':
                style_image = style_image.convert('RGB')
        except Exception as e:
            logger.warning(f"âš ï¸ é£æ ¼å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå°†è·³è¿‡: {e}")
            style_image = None
    
    # æ„å»ºå†…å®¹åˆ—è¡¨ï¼ˆä¸Doroåˆå½±ç›¸åŒï¼‰
    contents = [image_prompt]
    contents.append(user_image)
    contents.append(doro_image)
    if style_image:
        contents.append(style_image)
    
    # æ·»åŠ è´Ÿé¢æç¤ºè¯
    from .prompt_generator import doro_prompt_generator
    negative_prompt = doro_prompt_generator.get_negative_prompt()
    contents.append(f"Avoid: {negative_prompt}")
    
    # ä½¿ç”¨Gemini APIç”Ÿæˆå›¾ç‰‡ï¼ˆè€Œä¸æ˜¯Imagen 3ï¼‰
    response = await self._call_gemini_with_retry(contents)
    
    # æå–ç”Ÿæˆçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç°æœ‰çš„æå–é€»è¾‘ï¼‰
    generated_image = None
    
    # ä½¿ç”¨ç°æœ‰çš„å›¾ç‰‡æå–é€»è¾‘...
    # [ä¿æŒç°æœ‰çš„å›¾ç‰‡æå–ä»£ç ä¸å˜]
    
except Exception as e:
    logger.error(f"âŒ æ”¹è¿›çš„å›¾ç‰‡ç”Ÿæˆå¤±è´¥: {e}")
    # å¦‚æœå¤±è´¥ï¼Œå›é€€åˆ°åŸå§‹çš„ç®€å•æ–¹æ³•
    # [ä¿æŒåŸæœ‰çš„åå¤‡é€»è¾‘]
```

### 3. å…³é”®æ”¹è¿›ç‚¹

#### ğŸ”‘ æ ¸å¿ƒæ”¹è¿›ï¼š

1. **å®Œæ•´çš„æç¤ºè¯ç”Ÿæˆé€»è¾‘**ï¼š
   - âœ… ä½¿ç”¨`DoroPromptGenerator`çš„ä¸“ä¸šæç¤ºè¯æ„å»º
   - âœ… æ”¯æŒæ™¯ç‚¹ç±»å‹ã€Doroé£æ ¼ã€ç”¨æˆ·æè¿°ç­‰ä¸°å¯Œå‚æ•°
   - âœ… åŒ…å«æ—¶é—´ã€å¤©æ°”ã€å­£èŠ‚ã€æƒ…ç»ªç­‰å¢å¼ºç»†èŠ‚

2. **å›¾ç‰‡å†…å®¹å¤„ç†**ï¼š
   - âœ… åŒ…å«ç”¨æˆ·ç…§ç‰‡ã€Doroç…§ç‰‡å’Œé£æ ¼ç…§ç‰‡
   - âœ… æ­£ç¡®çš„å›¾ç‰‡é¢„å¤„ç†ï¼ˆRGBè½¬æ¢ã€æŒ‡é’ˆé‡ç½®ï¼‰
   - âœ… è´Ÿé¢æç¤ºè¯é¿å…ä½è´¨é‡ç”Ÿæˆ

3. **è§†é¢‘ç”Ÿæˆç‰¹å®šä¼˜åŒ–**ï¼š
   - âœ… æ·»åŠ è§†é¢‘ç”Ÿæˆç‰¹å®šçš„æ„å›¾è¦æ±‚
   - âœ… ç¡®ä¿æ¸…æ™°ç¨³å®šçš„æ„å›¾é€‚åˆåç»­åŠ¨ç”»
   - âœ… é¿å…å¤æ‚èƒŒæ™¯å¹²æ‰°è§†é¢‘è¿åŠ¨

4. **åå¤‡æœºåˆ¶**ï¼š
   - âœ… ä¿æŒåŸæœ‰çš„åå¤‡é€»è¾‘
   - âœ… å¦‚æœæ”¹è¿›æ–¹æ³•å¤±è´¥ï¼Œè‡ªåŠ¨å›é€€åˆ°ç®€å•æ–¹æ³•
   - âœ… ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§

### 4. é¢„æœŸæ•ˆæœ

#### ğŸ“ˆ æ”¹è¿›åçš„ä¼˜åŠ¿ï¼š

1. **å›¾ç‰‡è´¨é‡æå‡**ï¼š
   - ğŸ¯ è¾¾åˆ°533ad5eç‰ˆæœ¬çš„å›¾ç‰‡è´¨é‡æ°´å¹³
   - ğŸ¯ æ›´å‡†ç¡®çš„äººç‰©å’ŒDoroå½¢è±¡è¿˜åŸ
   - ğŸ¯ æ›´ä¸°å¯Œçš„æ™¯ç‚¹èƒŒæ™¯ç»†èŠ‚

2. **æç¤ºè¯ä¸°å¯Œåº¦**ï¼š
   - ğŸ¯ ä»ç®€å•çš„5-6ä¸ªè¦ç´ æ‰©å±•åˆ°15+ä¸ªè¦ç´ 
   - ğŸ¯ æ”¯æŒå¤šç§Doroé£æ ¼å’Œç”¨æˆ·è‡ªå®šä¹‰
   - ğŸ¯ åŒ…å«ä¸“ä¸šçš„æ‘„å½±å’Œæ„å›¾è¦æ±‚

3. **ç³»ç»Ÿç¨³å®šæ€§**ï¼š
   - ğŸ¯ ä¿æŒå½“å‰ç‰ˆæœ¬çš„è§†é¢‘ç”ŸæˆæˆåŠŸç‡
   - ğŸ¯ å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œåå¤‡æœºåˆ¶
   - ğŸ¯ å‘ä¸‹å…¼å®¹ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½

## ğŸ”„ å®æ–½è®¡åˆ’

### é˜¶æ®µ1ï¼šä»£ç ä¿®æ”¹
1. ä¿®æ”¹`_generate_image_prompt_for_video`å‡½æ•°
2. é›†æˆ`DoroPromptGenerator`é€»è¾‘
3. æ·»åŠ å›¾ç‰‡å†…å®¹å¤„ç†

### é˜¶æ®µ2ï¼šæµ‹è¯•éªŒè¯
1. æœ¬åœ°æµ‹è¯•å›¾ç‰‡ç”Ÿæˆè´¨é‡
2. éªŒè¯è§†é¢‘ç”ŸæˆåŠŸèƒ½æ­£å¸¸
3. å¯¹æ¯”533ad5eç‰ˆæœ¬çš„æ•ˆæœ

### é˜¶æ®µ3ï¼šéƒ¨ç½²ä¸Šçº¿
1. æäº¤ä»£ç åˆ°GitHub
2. æ›´æ–°æœåŠ¡å™¨ç‰ˆæœ¬
3. é‡å¯æœåŠ¡å™¨åº”ç”¨

## ğŸ“‹ æŠ€æœ¯è¦ç‚¹æ€»ç»“

### âœ… ä¿æŒä¸å˜çš„éƒ¨åˆ†ï¼š
- è§†é¢‘ç”Ÿæˆçš„æ ¸å¿ƒæŠ€æœ¯ï¼ˆç›´æ¥ä½¿ç”¨å›¾ç‰‡å¯¹è±¡ï¼‰
- å¼‚æ­¥æ“ä½œå¤„ç†å’Œè½®è¯¢æœºåˆ¶
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### ğŸ”„ æ”¹è¿›çš„éƒ¨åˆ†ï¼š
- å›¾ç‰‡æç¤ºè¯ç”Ÿæˆé€»è¾‘
- å›¾ç‰‡å†…å®¹å¤„ç†ï¼ˆåŒ…å«å¤šå¼ ç…§ç‰‡ï¼‰
- æç¤ºè¯ä¸°å¯Œåº¦å’Œä¸“ä¸šæ€§

### ğŸ¯ é¢„æœŸç»“æœï¼š
- å›¾ç‰‡è´¨é‡è¾¾åˆ°533ad5eç‰ˆæœ¬æ°´å¹³
- è§†é¢‘ç”Ÿæˆä¿æŒ100%æˆåŠŸç‡
- ç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡
