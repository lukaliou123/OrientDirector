# 🚀 OrientDiscover 本地启动指南

## 环境要求

- Python 3.9+（推荐使用 Python 3.9，避免兼容性问题）
- Git
- Conda（推荐）或 venv
- 现代浏览器（Chrome、Firefox、Safari 等）

## 快速启动步骤

### 1. 克隆项目

```bash
git clone https://github.com/hangeaiagent/OrientDiscover.git
cd OrientDiscover
```

### 2. 创建虚拟环境

#### 使用 Conda（推荐）
```bash
# 创建 Python 3.9 环境
conda create -n orient python=3.9 -y

# 激活环境
conda activate orient
```

#### 使用 venv
```bash
# 创建虚拟环境
python3 -m venv venv

# 激活环境（MacOS/Linux）
source venv/bin/activate

# 激活环境（Windows）
venv\Scripts\activate
```

### 3. 安装依赖

```bash
pip install -r requirements.txt
```

### 4. 配置 API 密钥

创建环境变量文件或在启动时设置：

```bash
# 设置高德地图 API 密钥（必需）
export AMAP_API_KEY="你的高德地图API密钥"
```

### 5. 启动服务

#### 方式一：分别启动前后端（推荐）

**启动后端服务（在项目根目录）：**
```bash
cd backend
python -m uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

**新开终端，启动前端服务（在项目根目录）：**
```bash
python start_frontend.py
```

#### 方式二：使用启动脚本

```bash
# 同时启动前后端
python start_app.py
```

#### 方式三：使用 Netlify Dev

首先安装 Netlify CLI：
```bash
npm install -g netlify-cli
```

然后启动：
```bash
npx netlify dev --port 8888
```

## 访问应用

- 前端地址：http://localhost:3000
- 后端 API：http://localhost:8000
- API 文档：http://localhost:8000/docs

## 服务端口说明

| 服务 | 默认端口 | 说明 |
|------|---------|------|
| 前端 | 3000 | 静态文件服务器 |
| 后端 | 8000 | FastAPI 服务器 |
| Netlify Dev | 8888 | 统一入口（代理前后端） |

## 常见问题

### 1. 方向获取失败

**问题**：应用无法自动获取设备方向

**解决方案**：
- 等待 1 秒后会自动显示手动输入框
- 点击指南针任意位置设置方向
- 或在输入框中输入方向角度（0-359°）

### 2. 位置权限被拒绝

**问题**：浏览器拒绝位置访问

**解决方案**：
1. 检查浏览器设置，允许 localhost:3000 访问位置
2. 刷新页面重新授权
3. 使用 HTTPS 环境（生产环境）

### 3. API 限制错误

**问题**：`CUQPS_HAS_EXCEEDED_THE_LIMIT`

**解决方案**：
- 高德地图 API 有调用频率限制
- 等待几分钟后重试
- 考虑升级 API 配额

### 4. Python 版本问题

**问题**：`ModuleNotFoundError` 或兼容性错误

**解决方案**：
```bash
# 检查 Python 版本
python --version

# 确保使用 Python 3.9
conda create -n orient python=3.9 -y
conda activate orient
```

## 开发调试

### 查看日志

- **前端日志**：浏览器开发者工具控制台
- **后端日志**：终端输出
- **应用内日志**：页面底部的日志面板

### 测试 API

```bash
# 健康检查
curl http://localhost:8000/api/health

# 测试探索功能
curl -X POST http://localhost:8000/api/explore-real \
  -H "Content-Type: application/json" \
  -d '{
    "latitude": 40.0,
    "longitude": 116.0,
    "heading": 90,
    "segment_distance": 10,
    "time_mode": "present"
  }'
```

### 清理缓存

```bash
# 删除 API 响应缓存
rm backend/data_cache.json

# 清理 Python 缓存
find . -type d -name __pycache__ -exec rm -r {} +
```

## 停止服务

- **Ctrl+C**：在各个终端中停止对应的服务
- **强制停止**：
  ```bash
  # 查找并停止 Python 进程
  pkill -f "uvicorn"
  pkill -f "python.*frontend"
  ```

## 部署建议

本地开发完成后，建议：
1. 使用 HTTPS 环境（方向 API 需要）
2. 配置环境变量管理 API 密钥
3. 使用进程管理器（如 PM2）管理服务
4. 配置反向代理（Nginx）统一入口

## 相关文档

- [方向问题修改](./方向问题修改.md)
- [高德地图 API 集成](../AMAP_API_INTEGRATION.md)
- [API 密钥设置](../API_KEYS_SETUP.md)
