# ğŸ—„ï¸ Spotåœ°å›¾ç›¸å†Œç³»ç»Ÿ - Supabaseæ•°æ®åº“é›†æˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®å·²æˆåŠŸé›†æˆSupabaseæ•°æ®åº“ï¼Œå°†åŸæœ‰çš„æœ¬åœ°æ–‡ä»¶æ•°æ®æºï¼ˆ`local_attractions_db.py` å’Œ `global_cities_db.py`ï¼‰è¿ç§»åˆ°äº‘ç«¯æ•°æ®åº“ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®

ç¡®ä¿`.env`æ–‡ä»¶åŒ…å«ä»¥ä¸‹Supabaseé…ç½®ï¼š

```bash
# Supabaseé…ç½®
SUPABASE_URL=https://uobwbhvwrciaxloqdizc.supabase.co
SUPABASE_ANON_KEY=your_anon_key_here
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key_here
```

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 3. å¯åŠ¨åç«¯æœåŠ¡

```bash
# æ–¹æ³•1: ä½¿ç”¨å¯åŠ¨è„šæœ¬
python start_supabase_backend.py

# æ–¹æ³•2: ç›´æ¥å¯åŠ¨
cd backend
python -m uvicorn main:app --host 0.0.0.0 --port 8001 --reload
```

### 4. æµ‹è¯•é›†æˆ

```bash
# è¿è¡Œè¿æ¥æµ‹è¯•
python test_supabase_connection.py

# æˆ–åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æµ‹è¯•é¡µé¢
http://localhost:3000/test_supabase_api.html
```

## ğŸ”— APIç«¯ç‚¹

### æ–°å¢çš„Supabase APIç«¯ç‚¹ï¼š

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/api/spot/health` | GET | æœåŠ¡å¥åº·æ£€æŸ¥ |
| `/api/spot/attractions` | GET | è·å–æ‰€æœ‰æ™¯ç‚¹ |
| `/api/spot/attractions/nearby` | GET | æŸ¥è¯¢é™„è¿‘æ™¯ç‚¹ |
| `/api/spot/attractions/category/{category}` | GET | æŒ‰ç±»åˆ«æŸ¥è¯¢æ™¯ç‚¹ |
| `/api/spot/attractions/city/{city}` | GET | æŒ‰åŸå¸‚æŸ¥è¯¢æ™¯ç‚¹ |
| `/api/spot/attractions/search` | GET | æœç´¢æ™¯ç‚¹ |
| `/api/spot/statistics` | GET | è·å–ç»Ÿè®¡ä¿¡æ¯ |
| `/api/explore-supabase` | POST | ä½¿ç”¨Supabaseæ•°æ®æ¢ç´¢ |

### å‚æ•°è¯´æ˜ï¼š

**é™„è¿‘æ™¯ç‚¹æŸ¥è¯¢** (`/api/spot/attractions/nearby`):
- `latitude`: çº¬åº¦ (å¿…éœ€)
- `longitude`: ç»åº¦ (å¿…éœ€)  
- `radius`: æœç´¢åŠå¾„ï¼Œå•ä½å…¬é‡Œ (é»˜è®¤50)

**æœç´¢æ™¯ç‚¹** (`/api/spot/attractions/search`):
- `query`: æœç´¢å…³é”®è¯ (å¿…éœ€ï¼Œè‡³å°‘2ä¸ªå­—ç¬¦)

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

æ•°æ®åº“åŒ…å«ä»¥ä¸‹ä¸»è¦è¡¨ï¼š

- `spot_attractions`: æ™¯ç‚¹ä¸»è¡¨
- `spot_attraction_contents`: å¤šè¯­è¨€å†…å®¹è¡¨
- `spot_attraction_media`: åª’ä½“èµ„æºè¡¨
- `spot_map_albums`: åœ°å›¾ç›¸å†Œè¡¨
- `spot_user_behaviors`: ç”¨æˆ·è¡Œä¸ºè¡¨

è¯¦ç»†ç»“æ„è¯·å‚è€ƒï¼š`docs/spots/db/01æ•°æ®åº“ç»“æ„0907.md`

## ğŸ”„ æ•°æ®è¿ç§»

### å†å²æ•°æ®è¿ç§»çŠ¶æ€ï¼š

- âœ… æ•°æ®åº“ç»“æ„å·²åˆ›å»º
- âœ… åç«¯APIå·²å¼€å‘
- âœ… å‰ç«¯ä»£ç å·²æ›´æ–°
- â³ æ•°æ®è¿ç§»è„šæœ¬ï¼š`docs/spots/db/02å†å²æ•°æ®è¿ç§»è„šæœ¬0907.sql`

### è¿ç§»æ­¥éª¤ï¼š

1. åœ¨Supabaseæ§åˆ¶å°æ‰§è¡Œ `docs/spots/db/database_setup.sql`
2. æ‰§è¡Œæ•°æ®è¿ç§»è„šæœ¬ `docs/spots/db/02å†å²æ•°æ®è¿ç§»è„šæœ¬0907.sql`
3. éªŒè¯æ•°æ®å®Œæ•´æ€§

## ğŸ§ª æµ‹è¯•åŠŸèƒ½

### 1. è¿æ¥æµ‹è¯•
```bash
python test_supabase_connection.py
```

### 2. Webç•Œé¢æµ‹è¯•
è®¿é—® `http://localhost:3000/test_supabase_api.html` è¿›è¡Œäº¤äº’å¼æµ‹è¯•

### 3. APIæ–‡æ¡£
è®¿é—® `http://localhost:8001/docs` æŸ¥çœ‹å®Œæ•´APIæ–‡æ¡£

## ğŸ“‚ æ–‡ä»¶ç»“æ„

```
backend/
â”œâ”€â”€ supabase_client.py          # Supabaseå®¢æˆ·ç«¯é…ç½®
â”œâ”€â”€ spot_api_service.py         # APIæœåŠ¡å±‚
â”œâ”€â”€ main.py                     # ä¸»åº”ç”¨ï¼ˆå·²æ·»åŠ Supabaseç«¯ç‚¹ï¼‰
â””â”€â”€ ...

docs/spots/db/
â”œâ”€â”€ 01æ•°æ®åº“ç»“æ„0907.md         # æ•°æ®åº“ç»“æ„æ–‡æ¡£
â”œâ”€â”€ 02å†å²æ•°æ®è¿ç§»æ–¹æ¡ˆ0907.md   # æ•°æ®è¿ç§»æ–¹æ¡ˆ
â”œâ”€â”€ 02å†å²æ•°æ®è¿ç§»è„šæœ¬0907.sql  # æ•°æ®è¿ç§»è„šæœ¬
â””â”€â”€ database_setup.sql          # æ•°æ®åº“åˆ›å»ºè„šæœ¬

test_supabase_api.html          # Webæµ‹è¯•ç•Œé¢
test_supabase_connection.py     # è¿æ¥æµ‹è¯•è„šæœ¬
start_supabase_backend.py       # å¯åŠ¨è„šæœ¬
.env.example                    # ç¯å¢ƒå˜é‡ç¤ºä¾‹
```

## ğŸ“ æ—¥å¿—é…ç½®

### æ—¥å¿—æ–‡ä»¶ä½ç½®
- **åç«¯æ—¥å¿—**: `logs/backend.log`
- **å‰ç«¯æ—¥å¿—**: `logs/frontend.log`
- **å¯åŠ¨æ—¥å¿—**: `logs/startup.log`

### æ—¥å¿—çº§åˆ«
- ERROR: é”™è¯¯ä¿¡æ¯
- WARNING: è­¦å‘Šä¿¡æ¯
- INFO: ä¸€èˆ¬ä¿¡æ¯
- DEBUG: è°ƒè¯•ä¿¡æ¯

### æŸ¥çœ‹æ—¥å¿—å‘½ä»¤
```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f logs/backend.log

# æŸ¥çœ‹å‰ç«¯æ—¥å¿—
tail -f logs/frontend.log

# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
tail -f logs/startup.log
```

### æ—¥å¿—è½®è½¬
- æ¯å¤©è‡ªåŠ¨è½®è½¬
- ä¿ç•™æœ€è¿‘7å¤©çš„æ—¥å¿—
- å‹ç¼©å†å²æ—¥å¿—

### æ—¥å¿—å†…å®¹
1. **åç«¯æ—¥å¿—**:
   - APIè¯·æ±‚è®°å½•
   - æ•°æ®åº“æ“ä½œ
   - é”™è¯¯è¿½è¸ª
   - æ€§èƒ½æŒ‡æ ‡

2. **å‰ç«¯æ—¥å¿—**:
   - ç”¨æˆ·æ“ä½œ
   - APIè°ƒç”¨
   - æ¸²æŸ“æ€§èƒ½
   - é”™è¯¯æŠ¥å‘Š

3. **å¯åŠ¨æ—¥å¿—**:
   - ç¯å¢ƒæ£€æŸ¥
   - ä¾èµ–éªŒè¯
   - æœåŠ¡å¯åŠ¨
   - é…ç½®åŠ è½½

## ğŸ”§ å‰ç«¯é›†æˆ

å‰ç«¯ä»£ç å·²æ›´æ–°ï¼Œä¸»è¦å˜æ›´ï¼š

### app.js å˜æ›´ï¼š
```javascript
// åŸæ¥ä½¿ç”¨æœ¬åœ°æ•°æ®
const apiEndpoint = `${API_BASE_URL}/api/explore-real`;

// ç°åœ¨ä½¿ç”¨Supabaseæ•°æ®åº“
const apiEndpoint = `${API_BASE_URL}/api/explore-supabase`;
```

### æ•°æ®æµç¨‹ï¼š
1. ç”¨æˆ·åœ¨å‰ç«¯å‘èµ·æ¢ç´¢è¯·æ±‚
2. å‰ç«¯è°ƒç”¨ `/api/explore-supabase` ç«¯ç‚¹
3. åç«¯ä»Supabaseæ•°æ®åº“æŸ¥è¯¢æ™¯ç‚¹æ•°æ®
4. è¿”å›æ ¼å¼åŒ–çš„æ™¯ç‚¹ä¿¡æ¯ç»™å‰ç«¯
5. å‰ç«¯æ˜¾ç¤ºæ™¯ç‚¹å¡ç‰‡å’Œè¯¦ç»†ä¿¡æ¯

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜ï¼š

1. **è¿æ¥å¤±è´¥**
   - æ£€æŸ¥`.env`æ–‡ä»¶ä¸­çš„Supabaseé…ç½®
   - ç¡®è®¤Supabase URLå’Œå¯†é’¥æ­£ç¡®
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

2. **æ•°æ®ä¸ºç©º**
   - ç¡®è®¤æ•°æ®åº“ä¸­æœ‰æ•°æ®
   - æ£€æŸ¥æ•°æ®è¿ç§»æ˜¯å¦å®Œæˆ
   - éªŒè¯è¡¨åå’Œå­—æ®µåæ˜¯å¦æ­£ç¡®

3. **æƒé™é”™è¯¯**
   - æ£€æŸ¥RLSï¼ˆè¡Œçº§å®‰å…¨ï¼‰ç­–ç•¥
   - ç¡®è®¤APIå¯†é’¥æƒé™
   - éªŒè¯ç”¨æˆ·è®¤è¯çŠ¶æ€

### è°ƒè¯•å‘½ä»¤ï¼š
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://localhost:8001/api/spot/health

# æµ‹è¯•æ™¯ç‚¹æŸ¥è¯¢
curl "http://localhost:8001/api/spot/attractions/nearby?latitude=39.9042&longitude=116.4074&radius=50"

# æŸ¥çœ‹æ—¥å¿—
tail -f backend.log
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å·²å®ç°çš„ä¼˜åŒ–ï¼š
- âœ… æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- âœ… åœ°ç†ä½ç½®ç©ºé—´ç´¢å¼•
- âœ… æŸ¥è¯¢ç»“æœç¼“å­˜
- âœ… è¿æ¥æ± ç®¡ç†

### è®¡åˆ’ä¸­çš„ä¼˜åŒ–ï¼š
- â³ Redisç¼“å­˜é›†æˆ
- â³ CDNå›¾ç‰‡åŠ é€Ÿ
- â³ æ•°æ®åº“è¯»å†™åˆ†ç¦»
- â³ å‘é‡æœç´¢ä¼˜åŒ–

## ğŸ”® æœªæ¥è®¡åˆ’

1. **åŠŸèƒ½æ‰©å±•**
   - ç›¸å†Œç®¡ç†åŠŸèƒ½
   - ç”¨æˆ·è¡Œä¸ºåˆ†æ
   - AIæ¨èç®—æ³•
   - å¤šè¯­è¨€å†…å®¹æ‰©å……

2. **æŠ€æœ¯å‡çº§**
   - GraphQL APIæ”¯æŒ
   - å®æ—¶æ•°æ®åŒæ­¥
   - ç¦»çº¿æ•°æ®ç¼“å­˜
   - ç§»åŠ¨ç«¯é€‚é…

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. è¿è¡Œæµ‹è¯•è„šæœ¬è¯Šæ–­é—®é¢˜
3. æŸ¥çœ‹APIæ–‡æ¡£äº†è§£è¯¦ç»†ç”¨æ³•
4. æ£€æŸ¥æ•°æ®åº“é…ç½®å’Œè¿æ¥çŠ¶æ€

---

**æœ€åæ›´æ–°**: 2024-12-13  
**ç‰ˆæœ¬**: v1.0.0  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª