<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–¹å‘æ¢ç´¢æ´¾å¯¹æ™ºèƒ½å·¥å…·</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles_doro.css">
</head>
<body>
    <div class="app-container">
        <!-- å¤´éƒ¨å¯¼èˆª -->
        <header class="header">
            <h1>ğŸ§­ æ–¹å‘æ¢ç´¢æ´¾å¯¹</h1>
            <button class="settings-btn" onclick="toggleSettings()">âš™ï¸</button>
        </header>

        <!-- è®¾ç½®é¢æ¿ -->
        <div class="settings-panel" id="settingsPanel">
            <div class="setting-group">
                <label>ç›®æ ‡è·ç¦»:</label>
                <select id="segmentDistance" onchange="updateSettings()">
                    <option value="5">5km</option>
                    <option value="10" selected>10km</option>
                    <option value="15">15km</option>
                    <option value="20">20km</option>
                </select>
            </div>
            <div class="setting-group">
                <label>æ¨¡å¼:</label>
                <select id="timeMode" onchange="updateSettings()">
                    <option value="present" selected>ç°ä»£æ¨¡å¼</option>
                    <option value="past">å¤ä»£æ¨¡å¼</option>
                </select>
            </div>

            <div class="setting-group">
                <label>é€Ÿåº¦ (km/h):</label>
                <input type="number" id="speed" value="120" min="1" max="1000" onchange="updateSettings()">
            </div>

            <!-- æ¼«æ¸¸åŠŸèƒ½ -->
            <div class="setting-group roaming-section">
                <label class="roaming-title">ğŸŒ æ¼«æ¸¸åˆ°:</label>
                <div class="roaming-inputs">
                    <div class="input-row">
                        <label>å›½å®¶:</label>
                        <input type="text" id="roamingCountry" placeholder="å¦‚ï¼šä¸­å›½" class="roaming-input">
                    </div>
                    <div class="input-row">
                        <label>åŸå¸‚:</label>
                        <input type="text" id="roamingCity" placeholder="å¦‚ï¼šåŒ—äº¬" class="roaming-input">
                    </div>
                    <div class="input-row">
                        <label>æ™¯ç‚¹:</label>
                        <input type="text" id="roamingPlace" placeholder="å¦‚ï¼šå¤©å®‰é—¨å¹¿åœº" class="roaming-input">
                    </div>
                </div>
                <button class="roaming-btn" onclick="confirmRoaming()">ğŸš€ ç¡®è®¤æ¼«æ¸¸åˆ°</button>
                <div class="roaming-status" id="roamingStatus" style="display: none;">
                    <div class="loading-spinner"></div>
                    <span>æ­£åœ¨æœç´¢ç›®æ ‡ä½ç½®...</span>
                </div>
            </div>
        </div>

        <!-- çŠ¶æ€æ˜¾ç¤ºåŒº -->
        <div class="status-section">
            <div class="location-info">
                <div class="current-location">
                    <span class="label">å½“å‰ä½ç½®:</span>
                    <span id="currentLocation">è·å–ä¸­...</span>
                </div>
                <div class="coordinates-info">
                    <span class="label">ç»çº¬åº¦:</span>
                    <span id="coordinates">--Â°, --Â°</span>
                </div>
                <div class="accuracy-info">
                    <span class="label">ç²¾åº¦:</span>
                    <span id="accuracy">--m</span>
                </div>
                <div class="compass-info">
                    <span class="label">æœå‘:</span>
                    <span id="compassDirection">--Â°</span>
                </div>
                <div class="direction-text">
                    <span class="label">æ–¹å‘:</span>
                    <span id="directionText">--</span>
                </div>
            </div>
            
            <!-- æŒ‡å—é’ˆæ˜¾ç¤º -->
            <div class="compass-container">
                <div class="compass" id="compass">
                    <div class="compass-needle" id="compassNeedle">
                        <div class="needle-diamond">
                            <div class="needle-north"></div>
                            <div class="needle-south"></div>
                        </div>
                    </div>
                    <div class="compass-center"></div>
                    <div class="compass-directions">
                        <div class="direction north">N</div>
                        <div class="direction east">E</div>
                        <div class="direction south">S</div>
                        <div class="direction west">W</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ§åˆ¶æŒ‰é’® -->
        <div class="controls">
            <button class="explore-btn" id="exploreBtn" onclick="startExploration()">
                ğŸš€ å¼€å§‹æ¢ç´¢
            </button>
            <button class="refresh-btn" onclick="refreshLocation()">
                ğŸ“ åˆ·æ–°ä½ç½®
            </button>
            <button class="end-journey-btn" id="endJourneyBtn" onclick="endJourney()" style="display: none;">
                ğŸ  ç»“æŸæ—…ç¨‹
            </button>
        </div>

        <!-- å†å²è®¿é—®åœºæ™¯ -->
        <div class="journey-history-section" id="journeyHistorySection" style="display: none;">
            <h3>ğŸ’ å·²è®¿é—®çš„åœ°ç‚¹</h3>
            <div class="history-places-container" id="historyPlacesContainer">
                <!-- å†å²è®¿é—®çš„åœ°ç‚¹å¡ç‰‡å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <!-- åœ°ç‚¹å¡ç‰‡å®¹å™¨ -->
        <div class="places-container" id="placesContainer">
            <!-- åœ°ç‚¹å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
        <div class="loading" id="loading" style="display: none;">
            <div class="spinner"></div>
            <p>æ­£åœ¨è®¡ç®—è·¯å¾„...</p>
        </div>

        <!-- æ—¥å¿—æ˜¾ç¤ºåŒº -->
        <div class="log-section">
            <div class="log-header">
                <h3>ç³»ç»Ÿæ—¥å¿—</h3>
                <button class="clear-log-btn" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
            </div>
            <div class="log-container" id="logContainer">
                <!-- æ—¥å¿—ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <!-- Googleè¡—æ™¯æ¨¡æ€æ¡† -->
        <div class="streetview-modal" id="streetviewModal" style="display: none;">
            <div class="streetview-modal-content">
                <div class="streetview-header">
                    <h3 id="streetviewTitle">ğŸ™ï¸ è¡—æ™¯è§†å›¾</h3>
                    <button class="close-streetview-btn" onclick="closeStreetView()">âœ•</button>
                </div>
                <div class="streetview-controls">
                    <button class="streetview-control-btn" onclick="resetStreetViewHeading()" title="é‡ç½®æœå‘">
                        ğŸ§­ é‡ç½®è§†è§’
                    </button>
                    <button class="streetview-control-btn" onclick="toggleStreetViewFullscreen()" title="å…¨å±">
                        ğŸ” å…¨å±
                    </button>
                    <button class="streetview-control-btn" onclick="shareStreetView()" title="åˆ†äº«ä½ç½®">
                        ğŸ“¤ åˆ†äº«
                    </button>
                </div>
                <div class="streetview-container" id="streetviewContainer">
                    <div class="streetview-loading" id="streetviewLoading">
                        <div class="streetview-spinner"></div>
                        <p>æ­£åœ¨åŠ è½½è¡—æ™¯...</p>
                    </div>
                    <div class="streetview-error" id="streetviewError" style="display: none;">
                        <div class="error-icon">ğŸš«</div>
                        <h4>è¡—æ™¯ä¸å¯ç”¨</h4>
                        <p id="streetviewErrorText">è¯¥ä½ç½®æš‚æ—¶æ²¡æœ‰è¡—æ™¯æ•°æ®</p>
                        <button class="retry-streetview-btn" onclick="retryStreetView()">é‡è¯•</button>
                    </div>
                </div>
                <div class="streetview-info" id="streetviewInfo">
                    <div class="streetview-location">
                        <span class="info-label">ğŸ“ ä½ç½®:</span>
                        <span id="streetviewLocation">--</span>
                    </div>
                    <div class="streetview-coordinates">
                        <span class="info-label">ğŸ“Š åæ ‡:</span>
                        <span id="streetviewCoords">--</span>
                    </div>
                    <div class="streetview-date">
                        <span class="info-label">ğŸ“… æ‹æ‘„æ—¶é—´:</span>
                        <span id="streetviewDate">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Googleè¡—æ™¯é®ç½©å±‚ -->
        <div class="streetview-overlay" id="streetviewOverlay" style="display: none;" onclick="closeStreetView()"></div>
        
        <!-- æ™¯ç‚¹åˆå½±ç”Ÿæˆæ¨¡æ€æ¡† -->
        <div class="selfie-modal" id="selfieModal" style="display: none;">
            <div class="selfie-modal-content">
                <button class="selfie-close-btn" onclick="closeSelfieModal()" title="å…³é—­">
                    âœ•
                </button>
                <div class="selfie-header">
                    <h3>ğŸ“¸ ç”Ÿæˆæ™¯ç‚¹åˆå½±</h3>
                </div>
                
                <div class="selfie-body">
                    <div class="selfie-info">
                        <h4 id="selfieAttractionName">æ™¯ç‚¹åç§°</h4>
                        <p id="selfieAttractionLocation">ä½ç½®ä¿¡æ¯</p>
                    </div>
                    
                    <div class="selfie-upload-section" id="selfieUploadSection">
                        <div class="upload-section">
                            <div class="upload-group">
                                <h4>ğŸ“· æ‚¨çš„ç…§ç‰‡</h4>
                                <div class="upload-area" id="uploadArea" onclick="document.getElementById('selfiePhotoInput').click()">
                                    <input type="file" id="selfiePhotoInput" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
                                    <div class="upload-placeholder" id="uploadPlaceholder">
                                        <div class="upload-icon">ğŸ“·</div>
                                        <p>ç‚¹å‡»ä¸Šä¼ æ‚¨çš„ç…§ç‰‡</p>
                                        <p class="upload-hint">æ”¯æŒ JPGã€PNG æ ¼å¼</p>
                                    </div>
                                    <img id="uploadPreview" class="upload-preview" style="display: none;" alt="é¢„è§ˆå›¾">
                                </div>
                            </div>
                            
                            <div class="upload-group">
                                <h4>ğŸ¨ èŒƒä¾‹é£æ ¼å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰</h4>
                                <div class="upload-area" id="styleUploadArea" onclick="document.getElementById('stylePhotoInput').click()">
                                    <input type="file" id="stylePhotoInput" accept="image/*" style="display: none;" onchange="handleStylePhotoUpload(event)">
                                    <div class="upload-placeholder" id="stylePlaceholder">
                                        <div class="upload-icon">ğŸ¨</div>
                                        <p>ç‚¹å‡»ä¸Šä¼ èŒƒä¾‹é£æ ¼å›¾ç‰‡</p>
                                        <p class="upload-hint">ç”¨äºæ¨¡ä»¿æœè£…æˆ–é£æ ¼</p>
                                    </div>
                                    <img id="stylePreview" class="upload-preview" style="display: none;" alt="é£æ ¼é¢„è§ˆå›¾">
                                </div>
                            </div>
                        </div>
                        
                        <div class="prompt-section">
                            <label for="customPrompt">è‡ªå®šä¹‰æç¤ºè¯ï¼ˆå¯é€‰ï¼‰ï¼š</label>
                            <textarea id="customPrompt" rows="3" placeholder="è¾“å…¥é¢å¤–è¦æ±‚ï¼Œå°†è¿½åŠ åˆ°åŸºç¡€æç¤ºè¯åé¢ã€‚ä¾‹å¦‚ï¼šæŒ‰ç¬¬äºŒä¸ªæ©™è‰²é«˜å­ç”·ç”Ÿï¼Œæ¢ä»–çš„è¡£æœå’Œè£¤å­æœè£…ï¼Œå¤´åƒæ›´æ¢æˆå½“å‰ä¸»äººçš„å¤´åƒï¼Œåªä¿ç•™ä¸€ä¸ªäºº"></textarea>
                        </div>
                        
                        <div class="selfie-actions">
                            <button class="generate-btn" id="generateBtn" onclick="generateSelfie()" disabled>
                                âœ¨ ç”Ÿæˆåˆå½±
                            </button>
                            <button class="cancel-btn" onclick="closeSelfieModal()">
                                âŒ å–æ¶ˆ
                            </button>
                        </div>
                    </div>
                    
                    <div class="selfie-loading" id="selfieLoading" style="display: none;">
                        <div class="loading-content">
                            <div class="selfie-spinner"></div>
                            <h4 class="loading-title">æ­£åœ¨ç”Ÿæˆæ‚¨çš„æ™¯ç‚¹åˆå½±...</h4>
                            <p class="loading-hint">è¿™å¯èƒ½éœ€è¦ 10-30 ç§’ï¼Œè¯·è€å¿ƒç­‰å¾… â°</p>
                        </div>
                    </div>
                    
                    <div class="selfie-result" id="selfieResult" style="display: none;">
                        <div class="generated-image-container">
                            <img id="generatedSelfie" class="generated-selfie" alt="ç”Ÿæˆçš„åˆå½±" onclick="showImageModal(this.src)">
                            <div class="image-hint">ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹å¤§å›¾</div>
                        </div>
                        <div class="result-actions">
                            <button class="download-btn" onclick="downloadSelfie()">
                                ğŸ’¾ ä¸‹è½½åˆå½±
                            </button>
                            <button class="regenerate-btn" onclick="regenerateWithCurrentStyle()">
                                ğŸ”„ å½“å‰é£æ ¼é‡æ–°ç”Ÿæˆ
                            </button>
                            <button class="share-btn" onclick="shareSelfie()">
                                ğŸ“¤ åˆ†äº«åˆå½±
                            </button>
                        </div>
                    </div>
                    
                    <div class="selfie-error" id="selfieError" style="display: none;">
                        <div class="error-icon">âŒ</div>
                        <h4>ç”Ÿæˆå¤±è´¥</h4>
                        <p id="selfieErrorMessage">ç”Ÿæˆåˆå½±æ—¶å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•</p>
                        <button class="retry-btn" onclick="resetSelfieGenerator()">é‡è¯•</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- åˆå½±ç”Ÿæˆé®ç½©å±‚ -->
        <div class="selfie-overlay" id="selfieOverlay" style="display: none;"></div>
        
        <!-- Doroåˆå½±ç”Ÿæˆæ¨¡æ€æ¡† -->
        <div class="doro-selfie-modal" id="doroSelfieModal" style="display: none;">
            <div class="doro-modal-content">
                <button class="doro-close-btn" onclick="closeDoroModal()" title="å…³é—­">
                    âœ•
                </button>
                <div class="doro-header">
                    <h3>ğŸ¤ Doroä¸æˆ‘åˆå½±</h3>
                    <p class="doro-subtitle">åˆ›å»ºæ‚¨ä¸è™šæ‹Ÿä¼™ä¼´Doroçš„ç²¾å½©åˆå½±</p>
                </div>
                
                <div class="doro-body">
                    <div class="doro-info">
                        <h4 id="doroAttractionName">æ™¯ç‚¹åç§°</h4>
                        <p id="doroAttractionLocation">ä½ç½®ä¿¡æ¯</p>
                    </div>
                    
                    <!-- ä¸Šä¼ åŒºåŸŸ -->
                    <div class="upload-section">
                        <div class="upload-group">
                            <h4>ğŸ“· æ‚¨çš„ç…§ç‰‡</h4>
                            <div class="upload-area" id="userPhotoArea" onclick="document.getElementById('doroUserPhotoInput').click()">
                                <input type="file" id="doroUserPhotoInput" accept="image/*" style="display: none;" onchange="handleDoroUserPhoto(event)">
                                <div class="upload-placeholder" id="userPhotoPlaceholder">
                                    <div class="upload-icon">ğŸ“·</div>
                                    <p>ç‚¹å‡»ä¸Šä¼ æ‚¨çš„ç…§ç‰‡</p>
                                    <p class="upload-hint">æ”¯æŒ JPGã€PNGã€WEBP æ ¼å¼</p>
                                </div>
                                <img id="userPhotoPreview" class="upload-preview" style="display: none;" alt="æ‚¨çš„ç…§ç‰‡">
                            </div>
                        </div>
                        
                        <div class="upload-group">
                            <h4>ğŸ­ é€‰æ‹©Doroå½¢è±¡</h4>
                            <div class="doro-selector-container">
                                <div class="doro-selector-tabs">
                                    <button class="doro-tab active" onclick="switchDoroTab('preset')">é¢„è®¾Doro</button>
                                    <button class="doro-tab" onclick="switchDoroTab('custom')">è‡ªå®šä¹‰Doro</button>
                                </div>
                                <div class="doro-selector-grid" id="doroSelectorGrid">
                                    <!-- åŠ¨æ€åŠ è½½Doroåˆ—è¡¨ -->
                                </div>
                                <div class="doro-upload-custom" id="doroUploadCustom" style="display: none;">
                                    <div class="upload-area" onclick="document.getElementById('doroCustomInput').click()">
                                        <input type="file" id="doroCustomInput" accept="image/*" style="display: none;" onchange="handleCustomDoro(event)">
                                        <div class="upload-placeholder">
                                            <div class="upload-icon">â•</div>
                                            <p>ä¸Šä¼ è‡ªå®šä¹‰Doroå½¢è±¡</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å¯é€‰ï¼šæœè£…é£æ ¼å‚è€ƒ -->
                    <div class="upload-section">
                        <div class="upload-group">
                            <h4>ğŸ‘” æœè£…é£æ ¼å‚è€ƒï¼ˆå¯é€‰ï¼‰</h4>
                            <div class="upload-area" id="stylePhotoArea" onclick="document.getElementById('doroStyleInput').click()">
                                <input type="file" id="doroStyleInput" accept="image/*" style="display: none;" onchange="handleDoroStylePhoto(event)">
                                <div class="upload-placeholder" id="stylePlaceholder">
                                    <div class="upload-icon">ğŸ‘”</div>
                                    <p>ç‚¹å‡»ä¸Šä¼ æœè£…é£æ ¼å‚è€ƒ</p>
                                    <p class="upload-hint">å¯é€‰ï¼šç”¨äºç»Ÿä¸€æœè£…é£æ ¼</p>
                                </div>
                                <img id="doroStylePreview" class="upload-preview" style="display: none;" alt="é£æ ¼å‚è€ƒ">
                            </div>
                        </div>
                        
                        <div class="upload-group">
                            <h4>âœï¸ è‡ªå®šä¹‰æç¤ºè¯ï¼ˆå¯é€‰ï¼‰</h4>
                            <textarea id="doroCustomPrompt" placeholder="è¾“å…¥é¢å¤–è¦æ±‚ï¼Œå°†è¿½åŠ åˆ°åŸºç¡€æç¤ºè¯åé¢ã€‚ä¾‹å¦‚ï¼šæŒ‰ç¬¬äºŒä¸ªæ©™è‰²é«˜å­ç”·ç”Ÿï¼Œæ¢ä»–çš„è¡£æœå’Œè£¤å­æœè£…ï¼Œå¤´åƒæ›´æ¢æˆå½“å‰ä¸»äººçš„å¤´åƒï¼Œåªä¿ç•™ä¸€ä¸ªäºº" rows="3"></textarea>
                        </div>
                    </div>
                    
                    <!-- æ“ä½œæŒ‰é’® -->
                    <div class="doro-actions">
                        <button class="doro-generate-btn" id="doroGenerateBtn" onclick="generateDoroSelfie()" disabled>
                            âœ¨ ç”ŸæˆDoroåˆå½±
                        </button>
                        <button class="doro-video-btn" id="doroVideoBtn" onclick="generateDoroVideo()" disabled>
                            ğŸ¬ ç”ŸæˆDoroåˆå½±è§†é¢‘
                        </button>
                        <button class="doro-cancel-btn" onclick="closeDoroModal()">
                            âŒ å–æ¶ˆ
                        </button>
                    </div>

                    
                    <!-- åŠ è½½çŠ¶æ€ -->
                    <div class="doro-loading" id="doroLoading" style="display: none;">
                        <div class="loading-content">
                            <div class="doro-spinner"></div>
                            <h4 class="loading-title">æ­£åœ¨ç”ŸæˆDoroåˆå½±...</h4>
                            <p class="loading-hint">AIæ­£åœ¨å°†æ‚¨ã€Doroå’Œæ™¯ç‚¹å®Œç¾èåˆ ğŸ¨</p>
                            <p class="loading-hint">é¢„è®¡éœ€è¦ 15-30 ç§’ â°</p>
                        </div>
                    </div>
                    
                    <!-- ç»“æœå±•ç¤º -->
                    <div class="doro-result" id="doroResult" style="display: none;">
                        <div class="generated-image-container">
                            <img id="generatedDoroSelfie" class="generated-selfie" alt="Doroåˆå½±" onclick="showImageModal(this.src)">
                            <div class="image-hint">ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹å¤§å›¾</div>
                        </div>
                        <div class="result-actions">
                            <button class="download-btn" onclick="downloadDoroSelfie()">
                                ğŸ’¾ ä¸‹è½½åˆå½±
                            </button>
                            <button class="regenerate-btn" onclick="regenerateDoroSelfie()">
                                ğŸ”„ é‡æ–°ç”Ÿæˆ
                            </button>
                            <button class="share-btn" onclick="shareDoroSelfie()">
                                ğŸ“¤ åˆ†äº«åˆå½±
                            </button>
                        </div>
                    </div>
                    
                    <!-- è§†é¢‘ç»“æœå±•ç¤º -->
                    <div class="doro-video-result" id="doroVideoResult" style="display: none;">
                        <div class="generated-video-container">
                            <video id="generatedDoroVideo" class="generated-video" controls>
                                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
                            </video>
                            <div class="video-hint">Doroåˆå½±è§†é¢‘å·²ç”Ÿæˆ</div>
                        </div>
                        <div class="video-result-actions">
                            <button class="download-btn" onclick="downloadDoroVideo()">
                                ğŸ’¾ ä¸‹è½½è§†é¢‘
                            </button>
                            <button class="regenerate-btn" onclick="regenerateDoroVideo()">
                                ğŸ”„ é‡æ–°ç”Ÿæˆè§†é¢‘
                            </button>
                            <button class="share-btn" onclick="shareDoroVideo()">
                                ğŸ“¤ åˆ†äº«è§†é¢‘
                            </button>
                        </div>
                    </div>
                    
                    <!-- é”™è¯¯æç¤º -->
                    <div class="doro-error" id="doroError" style="display: none;">
                        <div class="error-icon">ğŸ¤–ğŸ’¥</div>
                        <h4>AIæŠ›é”šäº†</h4>
                        <p id="doroErrorMessage">è¿™ç‚¹å°æ•…éšœï¼Œä½ çœ‹è‚¿ä¹ˆåŠï¼Ÿ</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Doroåˆå½±é®ç½©å±‚ -->
        <div class="doro-overlay" id="doroOverlay" style="display: none;"></div>
    </div>

    <!-- Google Maps JavaScript API é…ç½® -->
    <script>
        // APIåŸºç¡€URLé…ç½® - æ”¯æŒç¯å¢ƒå˜é‡æ§åˆ¶
        function getAPIBaseURL() {
            // æ£€æŸ¥æ˜¯å¦åœ¨ç”Ÿäº§ç¯å¢ƒï¼ˆé€šè¿‡åŸŸåè®¿é—®ï¼‰
            const isProduction = window.location.hostname === 'doro.gitagent.io' || 
                                 window.location.hostname.includes('gitagent.io');
            
            // æ£€æŸ¥localStorageä¸­çš„é…ç½®ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
            const localStorageConfig = localStorage.getItem('isUsedomainnameaddress');
            
            // æ£€æŸ¥URLå‚æ•°
            const urlHasUseDomain = window.location.search.includes('usedomainname=true');
            const urlHasUseLocal = window.location.search.includes('usedomainname=false');
            
            // å†³å®šä½¿ç”¨å“ªä¸ªAPI URL
            if (localStorageConfig === 'false' && !isProduction) {
                // æ˜ç¡®è®¾ç½®ä¸ºæœ¬åœ°å¼€å‘
                return 'http://localhost:8001';
            } else if (localStorageConfig === 'true' || urlHasUseDomain || isProduction) {
                // ç”Ÿäº§ç¯å¢ƒæˆ–æ˜ç¡®è®¾ç½®ä½¿ç”¨åŸŸå
                return 'https://doro.gitagent.io';
            } else if (urlHasUseLocal) {
                // URLå‚æ•°æ˜ç¡®æŒ‡å®šä½¿ç”¨æœ¬åœ°
                return 'http://localhost:8001';
            } else {
                // é»˜è®¤ï¼šå¦‚æœé€šè¿‡åŸŸåè®¿é—®åˆ™ä½¿ç”¨åŸŸåï¼Œå¦åˆ™ä½¿ç”¨æœ¬åœ°
                return isProduction ? 'https://doro.gitagent.io' : 'http://localhost:8001';
            }
        }
        
        const API_BASE_URL = getAPIBaseURL();
        console.log('ğŸ”§ API_BASE_URLé…ç½®:', API_BASE_URL);
        
        // åº”ç”¨é…ç½® - API Keyé…ç½®åœ¨ç¯å¢ƒå˜é‡ä¸­
        window.appConfig = {
            // æ³¨æ„ï¼šå®é™…éƒ¨ç½²æ—¶åº”ä»åç«¯æˆ–ç¯å¢ƒå˜é‡è·å–æ­¤å€¼
            // ä¸è¦å°†çœŸå®çš„API Keyæäº¤åˆ°ä»£ç åº“ï¼
            // å¼€å‘æ—¶è¯·åœ¨ .env æ–‡ä»¶ä¸­è®¾ç½® GOOGLE_MAPS_API_KEY
            googleMapsApiKey: 'AIzaSyC3fc8-5r4SWOISs0IIduiE4TOvE8-aFC0', // å°†è¢«åŠ¨æ€æ›¿æ¢
            useLangchain: true
        };

        // å°è¯•ä»åç«¯è·å–APIé…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰
        async function loadAppConfig() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/config/maps`);
                if (response.ok) {
                    const config = await response.json();
                    window.appConfig.googleMapsApiKey = config.google_maps_api_key;
                    console.log('âœ… ä»åç«¯è·å–åˆ°APIé…ç½®');
                }
            } catch (error) {
                console.log('âš ï¸ æ— æ³•ä»åç«¯è·å–APIé…ç½®ï¼Œä½¿ç”¨é»˜è®¤é…ç½®');
            }
        }

        // æ·»åŠ å…¨å±€çŠ¶æ€å˜é‡
        window.googleMapsLoadStatus = 'pending'; // pending, loading, loaded, failed

        // Google Maps API å›è°ƒå‡½æ•°
        window.initGoogleMaps = function() {
            console.log('âœ… Google Maps API å·²åŠ è½½');
            console.log('ğŸ™ï¸ Street View æœåŠ¡å·²å‡†å¤‡å°±ç»ª');
            window.googleMapsLoadStatus = 'loaded';

            // åˆå§‹åŒ–è¡—æ™¯ç›¸å…³å˜é‡
            if (typeof initGoogleMapsAPI === 'function') {
                initGoogleMapsAPI();
            }
            
            // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œé€šçŸ¥APIå·²åŠ è½½
            window.dispatchEvent(new Event('googleMapsLoaded'));
        };

        // åŠ¨æ€åŠ è½½Google Maps API
        function loadGoogleMapsAPI() {
            const apiKey = window.appConfig.googleMapsApiKey;
            
            console.log('ğŸ” å¼€å§‹åŠ è½½Google Maps API');
            console.log('   API Key:', apiKey ? apiKey.substring(0, 10) + '...' : 'æœªè®¾ç½®');

            if (!apiKey || apiKey === 'YOUR_GOOGLE_MAPS_API_KEY') {
                console.warn('âš ï¸ Google Maps API Key æœªé…ç½®');
                window.googleMapsLoadStatus = 'failed';
                return false;
            }

            // æ£€æŸ¥æ˜¯å¦å·²ç»åŠ è½½è¿‡
            if (window.google && window.google.maps) {
                console.log('âœ… Google Maps API å·²å­˜åœ¨');
                window.googleMapsLoadStatus = 'loaded';
                window.initGoogleMaps();
                return true;
            }

            window.googleMapsLoadStatus = 'loading';
            console.log('ğŸ”„ æ­£åœ¨åŠ è½½ Google Maps API...');
            
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&callback=initGoogleMaps&v=weekly&libraries=geometry`;
            script.async = true;
            script.defer = true;
            
            script.onload = function() {
                console.log('âœ… Google Maps scriptæ ‡ç­¾åŠ è½½å®Œæˆ');
            };
            
            script.onerror = function(error) {
                window.googleMapsLoadStatus = 'failed';
                console.error('âŒ Google Maps API åŠ è½½å¤±è´¥');
                console.log('ğŸ” è¯·æ£€æŸ¥:');
                console.log('   1. API Key æ˜¯å¦æ­£ç¡®');
                console.log('   2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸');
                console.log('   3. API Key æ˜¯å¦æœ‰æ­£ç¡®çš„æƒé™');
                console.log('   4. æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰å…¶ä»–é”™è¯¯');
            };
            
            document.head.appendChild(script);
            return true;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸš€ OrientDiscover åº”ç”¨å¯åŠ¨');

            // å…ˆå°è¯•åŠ è½½é…ç½®
            await loadAppConfig();

            // ç„¶ååŠ è½½Google Maps API
            loadGoogleMapsAPI();
        });
    </script>

    <script src="app.js"></script>
</body>
</html>